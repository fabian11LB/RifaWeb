<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Rifa ‚Äî Overlay alineado al p√≥ster</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0;font-family:Segoe UI,Arial,Helvetica,sans-serif}
    body{display:flex;align-items:center;justify-content:center;min-height:100vh;background:#fff;padding:1rem}

    /* VARIABLES (porcentajes para alinear la grilla sobre la imagen) */
    :root{
      --topPct: 18.658280922431867%;
      --leftPct: 13.23283082077052%;
      --widthPct: 64.99162479061977%;
      --heightPct: 77.67295597484278%;
    }

    /* contenedor del p√≥ster (imagen) */
    .poster {
      position: relative;
      width: min(600px, 92vw); /* ajustable: ancho m√°ximo del p√≥ster en la p√°gina */
      box-shadow: 0 6px 24px rgba(0,0,0,0.12);
      background: #fff;
    }
    .poster img {
      display:block;
      width:100%;
      height:auto;
      user-select:none;
      -webkit-user-drag: none;
    }

    /* GRILLA: posicionada respecto al contenedor .poster usando % */
    .grilla {
      position: absolute;
      top: var(--topPct);
      left: var(--leftPct);
      width: var(--widthPct);
      height: var(--heightPct);
      display: grid;
      grid-template-columns: repeat(10, 1fr);
      grid-template-rows: repeat(10, 1fr);
      gap: 0;
      pointer-events: auto;
      user-select: none;
    }

    .grilla button{
      width:100%; height:100%;
      border: 1px solid rgba(0,0,0,.12);
      background: rgba(255,255,255,0.12);
      cursor: pointer;
      position: relative;
      font-size: calc(min(2.4vmin, 18px));
      color:#000;
      transition: color .15s, background .15s;
    }

    .grilla.ocultarNum button{ color: transparent; }

    .grilla button.vendido{
      background: rgba(229,57,53,0.45);
      color: #400;
    }
    .grilla button.vendido::after{
      content:'';
      position:absolute; inset:0; margin:auto;
      width:90%; height:2px; background:#b71c1c;
    }

    /* modal QR (fijo en pantalla) */
    .modal{
      position:fixed; inset:0; display:none;
      align-items:center; justify-content:center;
      background:rgba(0,0,0,.55); padding:1rem; z-index:999;
    }
    .modal.visible{ display:flex; }
    .modal-content{
      background:#fff; padding:1rem; border-radius:8px; max-width:360px; width:100%;
      text-align:center; box-shadow:0 6px 24px rgba(0,0,0,.2);
    }
    .modal-content img{ width:100%; height:auto; margin:.7rem 0; }
    .modal-content button{ padding:.45rem .9rem; border-radius:6px; border:none; background:#d40055; color:#fff; cursor:pointer; }
    /* ayuda r√°pida: indicador de modo ajuste */
    .status {
      margin-top:.6rem; font-size:13px; color:#444; text-align:center;
    }

    @media (max-width:420px){
      .poster{ width: 94vw; }
      .grilla button{ font-size: 9px; }
    }
  </style>
</head>
<body>

  <div style="max-width:640px;width:100%">
    <div class="poster" id="posterWrap">
      <!-- Reemplaza poster.png por el nombre de tu imagen del flyer -->
      <img id="posterImg" src="poster.png" alt="P√≥ster rifa ‚Äî coloca aqu√≠ tu imagen">
      <div class="grilla" id="grilla" aria-hidden="false"></div>
    </div>

    <div class="status" id="statusLine">
      Atajos: <strong>V</strong> vender ¬∑ <strong>G</strong> ocultar/mostrar n√∫meros ¬∑ <strong>A</strong> modo ajuste (flechas / [ ] / +/-). Usa A para activar mover/ajustar.
    </div>
  </div>

  <!-- Modal QR -->
  <div class="modal" id="modal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-content">
      <h3 id="tituloQR">N√∫mero 00</h3>
      <img id="imgQR" src="" alt="C√≥digo QR">
      <br>
      <button id="cerrarModal">Cerrar</button>
    </div>
  </div>

  <script>
    /* ----------------- util: localStorage seguro ----------------- */
    function safeSetItem(key, value){
      try { localStorage.setItem(key, value); }
      catch(e){ /* no disponible (modo privado, bloqueo) */ }
    }
    function safeGetItem(key){
      try { return localStorage.getItem(key); }
      catch(e){ return null; }
    }
    function readFloat(key, fallback){ const v = safeGetItem(key); return v !== null ? parseFloat(v) : fallback; }

    /* ----------------- par√°metros iniciales (porcentajes detectados) ----------------- */
    // valores por defecto calculados desde la imagen que subiste
    const DEF = {
      topPct: 18.658280922431867,
      leftPct: 13.23283082077052,
      widthPct: 64.99162479061977,
      heightPct: 77.67295597484278
    };

    let topPct   = readFloat('grillaTopPct', DEF.topPct);
    let leftPct  = readFloat('grillaLeftPct', DEF.leftPct);
    let widthPct = readFloat('grillaWidthPct', DEF.widthPct);
    let heightPct= readFloat('grillaHeightPct', DEF.heightPct);

    const root = document.documentElement;
    function aplicarPos(){
      root.style.setProperty('--topPct', topPct + '%');
      root.style.setProperty('--leftPct', leftPct + '%');
      root.style.setProperty('--widthPct', widthPct + '%');
      root.style.setProperty('--heightPct', heightPct + '%');
    }
    aplicarPos();

    /* ----------------- generaci√≥n de botones (10x10) ----------------- */
    const TOTAL = 100;
    const vendidos = new Set(JSON.parse(safeGetItem('vendidos') || '[]'));
    const grilla = document.getElementById('grilla');

    for (let i=0;i<TOTAL;i++){
      const b = document.createElement('button');
      b.type = 'button';
      b.textContent = i.toString().padStart(2,'0');
      b.dataset.num = i;
      b.addEventListener('click', abrirQR);
      if (vendidos.has(i.toString())) b.classList.add('vendido');
      grilla.appendChild(b);
    }

    /* ----------------- modal QR ----------------- */
    function abrirQR(e){
      const num = e.currentTarget.dataset.num;
      if (vendidos.has(num)) return; // si ya vendido no mostrar modal (igual que antes)
      const m = document.getElementById('modal'), t=document.getElementById('tituloQR'), i=document.getElementById('imgQR');
      t.textContent = `N√∫mero ${num.padStart(2,'0')}`;
      // reemplaza 'qrnequi.png' por la imagen QR que quieras mostrar
      i.src = 'qrnequi.png';
      m.classList.add('visible');
      m.setAttribute('aria-hidden','false');
    }
    document.getElementById('cerrarModal').onclick = ()=> {
      const m = document.getElementById('modal');
      m.classList.remove('visible');
      m.setAttribute('aria-hidden','true');
    };

    /* ----------------- vender con tecla V ----------------- */
    window.addEventListener('keydown', e=>{
      if (e.key.toLowerCase()==='v'){
        const n = prompt('¬øQu√© n√∫mero vendiste? (00-99)');
        if (n===null) return;
        const num = parseInt(n,10);
        if (!Number.isNaN(num) && num>=0 && num<TOTAL){
          vendidos.add(num.toString());
          const btn = [...grilla.children].find(b=>b.dataset.num==num);
          if (btn) btn.classList.add('vendido');
          safeSetItem('vendidos', JSON.stringify([...vendidos]));
          console.log(`Comprado: ${num.toString().padStart(2,'0')}`);
        }
      }
    });

    /* ----------------- ocultar/mostrar n√∫meros G ----------------- */
    let ocultandoNumeros = safeGetItem('ocultarNumeros') === 'true';
    grilla.classList.toggle('ocultarNum', ocultandoNumeros);

    /* ----------------- modo AJUSTE (A) ‚Üí mover/resize con flechas y teclas */ 
    let ajusteActivo = false;
    const statusLine = document.getElementById('statusLine');

    function setStatus(){
      statusLine.textContent = `Atajos: V vender ¬∑ G ocultar/mostrar n√∫meros ¬∑ A modo ajuste (${ajusteActivo? 'ON ‚Äî usa flechas / [ ] / + -':'OFF'})`;
    }
    setStatus();

    window.addEventListener('keydown', e=>{
      // G ‚Üí ocultar n√∫meros
      if (e.key.toLowerCase()==='g'){
        ocultandoNumeros = !ocultandoNumeros;
        grilla.classList.toggle('ocultarNum', ocultandoNumeros);
        safeSetItem('ocultarNumeros', ocultandoNumeros);
        if (console.clear) console.clear();
        console.log(ocultandoNumeros ? 'N√∫meros OCULTOS' : 'N√∫meros VISIBLES');
        return;
      }

      // A ‚Üí toggle ajuste
      if (e.key.toLowerCase()==='a'){
        ajusteActivo = !ajusteActivo;
        setStatus();
        if (console.clear) console.clear();
        console.log(ajusteActivo ? 'üîß MODO AJUSTE ON' : 'üîí MODO AJUSTE OFF');
        return;
      }

      if (!ajusteActivo) return;

      // ajuste con flechas: mover top/left en porcentaje
      const step = 0.4; // porcentaje por pulsaci√≥n
      if (e.key === 'ArrowUp'){ topPct = Math.max(0, topPct - step); aplicarPos(); safeSetItem('grillaTopPct', topPct); e.preventDefault(); return; }
      if (e.key === 'ArrowDown'){ topPct = Math.min(100, topPct + step); aplicarPos(); safeSetItem('grillaTopPct', topPct); e.preventDefault(); return; }
      if (e.key === 'ArrowLeft'){ leftPct = Math.max(0, leftPct - step); aplicarPos(); safeSetItem('grillaLeftPct', leftPct); e.preventDefault(); return; }
      if (e.key === 'ArrowRight'){ leftPct = Math.min(100, leftPct + step); aplicarPos(); safeSetItem('grillaLeftPct', leftPct); e.preventDefault(); return; }

      // ajustar tama√±o: [ ] modifican ancho, + - modifican alto
      if (e.key === '['){ widthPct = Math.max(5, widthPct - step); aplicarPos(); safeSetItem('grillaWidthPct', widthPct); e.preventDefault(); return; }
      if (e.key === ']'){ widthPct = Math.min(100, widthPct + step); aplicarPos(); safeSetItem('grillaWidthPct', widthPct); e.preventDefault(); return; }
      if (e.key === '+' || e.key === '='){ heightPct = Math.min(100, heightPct + step); aplicarPos(); safeSetItem('grillaHeightPct', heightPct); e.preventDefault(); return; }
      if (e.key === '-' || e.key === '_'){ heightPct = Math.max(5, heightPct - step); aplicarPos(); safeSetItem('grillaHeightPct', heightPct); e.preventDefault(); return; }
    });

    /* ----------------- √∫ltimo: si imagen no existe, mostrar pista ----------------- */
    const posterImg = document.getElementById('posterImg');
    posterImg.addEventListener('error', ()=>{
      posterImg.style.display = 'none';
      const wrap = document.getElementById('posterWrap');
      const warn = document.createElement('div');
      warn.style.padding = '2rem';
      warn.style.textAlign = 'center';
      warn.innerHTML = '<strong>Coloca tu imagen del p√≥ster en el mismo directorio y n√≥mbrala <code>poster.png</code> (o edita el src en el HTML).</strong>';
      wrap.appendChild(warn);
    });
  </script>
</body>
</html>
