<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Rifa – Amor y Amistad</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    *{box-sizing:border-box;margin:0;padding:0;font-family:Segoe UI,Arial,Helvetica,sans-serif}
    body{
      height:100vh;
      background:url("fondo.png") center top/cover no-repeat;
      overflow:hidden;
      display:flex;
      justify-content:center;
      align-items:flex-start;
    }
    /* REJILLA FIJA */
    .grilla{
      position:fixed;
      top:var(--top,290px);
      left:50%;
      transform:translateX(-50%);
      display:grid;
      grid-template-columns:repeat(10,var(--cellW,40px));
      grid-auto-rows:var(--cellH,40px);
      gap:0;
      user-select:none;
      background:rgba(255,255,255,0.85);
      padding:5px;
      border-radius:6px;
      box-shadow:0 2px 8px rgba(0,0,0,.3);
    }
    /* BOTONES */
    .grilla button{
      width:100%;height:100%;
      border:1px solid rgba(0,0,0,.25);
      background:transparent;
      cursor:pointer;
      font-size:calc(var(--cellH) * 0.35);
      color:#000;
      transition:all .2s;
    }
    .grilla.ocultarNum button{color:transparent}
    /* VENDIDO */
    .grilla button.vendido{
      background:rgba(229,57,53,.45);
    }
    .grilla button.vendido::after{
      content:'';position:absolute;
      inset:0;margin:auto;
      width:90%;height:2px;
      background:#b71c1c;
    }
    /* MODAL QR */
    .modal{
      position:fixed;inset:0;
      background:rgba(0,0,0,.55);
      display:flex;align-items:center;justify-content:center;
      padding:1rem;display:none;
    }
    .modal.visible{display:flex}
    .modal-content{
      background:#fff;
      padding:1.2rem 1.5rem;
      border-radius:8px;
      text-align:center;
      max-width:320px;
      box-shadow:0 2px 10px rgba(0,0,0,.4);
    }
    .modal-content img{width:100%;margin:.8rem 0}
    .modal-content button{
      padding:.4rem 1rem;
      border:none;
      background:#d40055;
      color:#fff;
      border-radius:4px;
      cursor:pointer;
    }
  </style>
</head>
<body>

  <div class="grilla" id="grilla"></div>

  <div class="modal" id="modal">
    <div class="modal-content">
      <h3 id="tituloQR">Número 00</h3>
      <img id="imgQR" src="" alt="Código QR">
      <br>
      <button id="cerrarModal">Cerrar</button>
    </div>
  </div>

  <script>
    // --- Fallback seguro para localStorage ---
    function safeStorage(){
      try{
        const test="__test__";
        localStorage.setItem(test,test);
        localStorage.removeItem(test);
        return localStorage;
      }catch(e){
        console.warn("⚠ localStorage no disponible, usando memoria.");
        let memory={};
        return {
          getItem:k=>memory[k]||null,
          setItem:(k,v)=>{memory[k]=v},
          removeItem:k=>{delete memory[k]}
        }
      }
    }
    const storage=safeStorage();

    const TOTAL=100,vendidos=new Set(JSON.parse(storage.getItem('vendidos')||'[]'));
    const grilla=document.getElementById('grilla');
    const root=document.documentElement;

    // crea botones 00-99
    for(let i=0;i<TOTAL;i++){
      const b=document.createElement('button');
      b.textContent=i.toString().padStart(2,'0');
      b.dataset.num=i;
      b.addEventListener('click',abrirQR);
      if(vendidos.has(i.toString())){
        b.classList.add('vendido');
      }
      grilla.appendChild(b);
    }

    // MODAL QR
    function abrirQR(e){
      const num=e.target.dataset.num;
      if(vendidos.has(num))return;
      document.getElementById('tituloQR').textContent=`Número ${num.padStart(2,'0')}`;
      document.getElementById('imgQR').src='qrnequi.png';
      document.getElementById('modal').classList.add('visible');
    }
    document.getElementById('cerrarModal').onclick=()=>document.getElementById('modal').classList.remove('visible');

    // MARCAR COMO VENDIDO
    window.addEventListener('keydown',e=>{
      if(e.key.toLowerCase()==='v'){
        const n=prompt('¿Qué número vendiste? (00-99)');
        if(n===null)return;

